server:
  port: 8080

spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOriginPatterns: "*"
            allowedMethods: "*"
            allowedHeaders: "*"
            allowCredentials: true
            maxAge: 3600
      routes:
        # 认证服务路由 - 支持 /api/auth 和 /auth
        - id: auth-service-api
          uri: http://localhost:8081
          predicates:
            - Path=/api/auth/**
          filters:
            - RewritePath=/api/auth/?(?<segment>.*), /auth/$\{segment}
        - id: auth-service
          uri: http://localhost:8081
          predicates:
            - Path=/auth/**
          filters:
            - RewritePath=/auth/?(?<segment>.*), /auth/$\{segment}
        
        # 用户服务路由 - 支持 /api/user 和 /user
        - id: user-service-api
          uri: http://localhost:8082
          predicates:
            - Path=/api/user/**
          filters:
            - RewritePath=/api/user/(?<segment>.*), /users/$\{segment}
            - AuthenticationFilter
        - id: user-service
          uri: http://localhost:8082
          predicates:
            - Path=/user/**
          filters:
            - RewritePath=/user/(?<segment>.*), /users/$\{segment}
            - AuthenticationFilter
        
        # 社团服务路由 - 支持 /api/club、/api/clubs、/club 和 /clubs
        # 精确匹配列表（无尾随斜杠）
        - id: club-service-api-clubs-root
          uri: http://localhost:8003
          predicates:
            - Path=/api/clubs
          filters:
            - RewritePath=/api/clubs, /clubs
            - AuthenticationFilter
        - id: club-service-clubs-root
          uri: http://localhost:8003
          predicates:
            - Path=/clubs
          filters:
            - RewritePath=/clubs, /clubs
            - AuthenticationFilter
        - id: club-service-api-clubs
          uri: http://localhost:8003
          predicates:
            - Path=/api/clubs/**
          filters:
            - StripPrefix=1
            - AuthenticationFilter
        - id: club-service-api-club
          uri: http://localhost:8003
          predicates:
            - Path=/api/club/**
          filters:
            - RewritePath=/api/club/?(?<segment>.*), /clubs/$\{segment}
            - AuthenticationFilter
        - id: club-service-clubs
          uri: http://localhost:8003
          predicates:
            - Path=/clubs/**
          filters:
            - RewritePath=/clubs/?(?<segment>.*), /clubs/$\{segment}
            - AuthenticationFilter
        - id: club-service-club
          uri: http://localhost:8003
          predicates:
            - Path=/club/**
          filters:
            - RewritePath=/club/?(?<segment>.*), /clubs/$\{segment}
            - AuthenticationFilter
        
        # 活动服务路由 - 支持 /api/activities 和 /activities
        # 精确匹配列表（无尾随斜杠）
        - id: activity-service-api-root
          uri: http://localhost:8084
          predicates:
            - Path=/api/activities
          filters:
            - RewritePath=/api/activities, /activities
            - AuthenticationFilter
        - id: activity-service-root
          uri: http://localhost:8084
          predicates:
            - Path=/activities
          filters:
            - RewritePath=/activities, /activities
            - AuthenticationFilter
        - id: activity-service-api
          uri: http://localhost:8084
          predicates:
            - Path=/api/activities/**
          filters:
            - RewritePath=/api/activities/?(?<segment>.*), /activities/$\{segment}
            - AuthenticationFilter
        - id: activity-service
          uri: http://localhost:8084
          predicates:
            - Path=/activities/**
          filters:
            - RewritePath=/activities/?(?<segment>.*), /activities/$\{segment}
            - AuthenticationFilter

        # 活动评论路由 - 支持 /api/comments 和 /comments
        - id: activity-comments-api
          uri: http://localhost:8084
          predicates:
            - Path=/api/comments/**
          filters:
            - RewritePath=/api/comments/?(?<segment>.*), /comments/$\{segment}
            - AuthenticationFilter
        - id: activity-comments
          uri: http://localhost:8084
          predicates:
            - Path=/comments/**
          filters:
            - RewritePath=/comments/?(?<segment>.*), /comments/$\{segment}
            - AuthenticationFilter
        
        # 消息服务路由 - 支持 /api/messages 和 /messages
        - id: message-service-messages-api
          uri: http://localhost:8083
          predicates:
            - Path=/api/messages/**
          filters:
            - RewritePath=/api/messages/?(?<segment>.*), /messages/$\{segment}
            - AuthenticationFilter
        - id: message-service-messages
          uri: http://localhost:8083
          predicates:
            - Path=/messages/**
          filters:
            - RewritePath=/messages/?(?<segment>.*), /messages/$\{segment}
            - AuthenticationFilter
        # 通知服务路由 - 支持 /api/notifications 和 /notifications
        - id: message-service-notifications-api
          uri: http://localhost:8083
          predicates:
            - Path=/api/notifications/**
          filters:
            - RewritePath=/api/notifications/?(?<segment>.*), /notifications/$\{segment}
            - AuthenticationFilter
        - id: message-service-notifications
          uri: http://localhost:8083
          predicates:
            - Path=/notifications/**
          filters:
            - RewritePath=/notifications/?(?<segment>.*), /notifications/$\{segment}
            - AuthenticationFilter
        
        # 统计服务路由 - 支持 /api/stats 和 /stats
        - id: stats-service-api
          uri: http://localhost:8004
          predicates:
            - Path=/api/stats/**
          filters:
            - RewritePath=/api/stats/(?<segment>.*), /stats/$\{segment}
            - AuthenticationFilter
        - id: stats-service
          uri: http://localhost:8004
          predicates:
            - Path=/stats/**
          filters:
            - RewritePath=/stats/(?<segment>.*), /stats/$\{segment}
            - AuthenticationFilter
        

  # Redis配置
  data:
    redis:
      host: localhost
      port: 6379
      password:
      database: 0
      timeout: 60000  # 连接超时时间（毫秒）
      lettuce:
        pool:
          max-active: 8  # 最大连接数
          max-wait: -1ms  # 最大阻塞等待时间，负值表示无限制
          max-idle: 8  # 最大空闲连接数
          min-idle: 0  # 最小空闲连接数

# Eureka配置
eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/
  instance:
    preferIpAddress: true

# JWT配置
jwt:
  secret: campus_club_management_system_secret_key_2025
  expiration: 86400000  # 24小时
  refreshExpiration: 604800000  # 7天

# 日志配置
logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    reactor.netty: INFO
    com.campusclub.gateway: INFO